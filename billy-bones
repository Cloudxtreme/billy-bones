#!/usr/bin/env ruby
# Put launch code here
$LOAD_PATH << 'lib'

require 'sinatra' # Has to be here for traditional approach
require 'config'

get '/' do
  # Doesn't load additional attributes otherwise
  @bills = Bill.all(order: [:date.desc]).to_a.map{|e| e.to_hash}
  haml :bills
end

get '/category/:id' do |cat_id|
  @category = Category.get(cat_id)
  cat_type = @category.type
  @fields = cat_type.required_fields + cat_type.computations.keys
  haml :category
end
